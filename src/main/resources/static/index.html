<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Villes et Départements</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-city"></i> Gestion des Villes et Départements</h1>
            <p class="subtitle">Interface d'administration pour la gestion des données territoriales françaises</p>
            <div class="header-actions">
                <div class="lang-switcher">
                    <label for="lang-select" title="Langue"><i class="fas fa-globe"></i></label>
                    <select id="lang-select" onchange="onLanguageChange(this.value)">
                        <option value="fr">FR</option>
                        <option value="en">EN</option>
                        <option value="de">DE</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="helloPing()">
                    <i class="fas fa-hand-paper"></i> Comment ça marche ?
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="villes">
                <i class="fas fa-building"></i> Villes
            </button>
            <button class="tab-btn" data-tab="departements">
                <i class="fas fa-map"></i> Départements
            </button>
        </nav>

        <!-- Messages de feedback -->
        <div id="message" class="message hidden"></div>

        <!-- Section Villes -->
        <div id="villes-section" class="tab-content active">
            <div class="section-header">
                <h2><i class="fas fa-building"></i> Gestion des Villes</h2>
                <button class="btn btn-primary " onclick="showAddVilleForm()">
                    <i class="fas fa-plus"></i> Ajouter une ville
                </button>
            </div>

            <!-- Formulaire d'ajout/modification de ville -->
            <div id="ville-form-container" class="form-container hidden">
                <div class="form-header">
                    <h3 id="ville-form-title"><i class="fas fa-plus"></i> Ajouter une nouvelle ville</h3>
                    <button class="btn-close" onclick="hideVilleForm()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="ville-form">
                    <div class="form-group">
                        <label for="ville-nom"><i class="fas fa-city"></i> Nom de la ville</label>
                        <input type="text" id="ville-nom" name="nom" required 
                               placeholder="Ex: Paris, Lyon, Marseille..." maxlength="100">
                    </div>
                    <div class="form-group">
                        <label for="ville-habitants"><i class="fas fa-users"></i> Nombre d'habitants</label>
                        <input type="number" id="ville-habitants" name="nbHabitants" required 
                               min="1" max="50000000" placeholder="Ex: 2165423">
                    </div>
                    <div class="form-group">
                        <label for="ville-departement"><i class="fas fa-map-marker-alt"></i> Département</label>
                        <select id="ville-departement" name="departement" required>
                            <option value="">-- Sélectionner un département --</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="hideVilleForm()">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </form>
            </div>

            <!-- Filtres et recherche -->
            <div class="filters-container">
                <div class="search-group">
                    <i class="fas fa-search"></i>
                    <input type="text" id="ville-search" placeholder="Rechercher une ville..." onkeyup="filterVilles()">
                </div>
                <div class="filter-group">
                    <label for="departement-filter">Filtrer par département :</label>
                    <select id="departement-filter" onchange="filterVilles()">
                        <option value="">Tous les départements</option>
                    </select>
                </div>
                <div class="sort-group">
                    <label for="ville-sort">Trier par :</label>
                    <select id="ville-sort" onchange="sortVilles()">
                        <option value="nom">Nom (A-Z)</option>
                        <option value="nbHabitants">Population (décroissant)</option>
                        <option value="departement.nom">Département (A-Z)</option>
                        <option value="departement.code">Code département</option>
                    </select>
                </div>
            </div>

            <!-- Outils avancés Villes -->
            <details class="advanced-tools">
                <summary><i class="fas fa-wrench"></i> Recherches et outils avancés (Villes)</summary>
                <div class="advanced-grid">
                    <div class="tool-card">
                        <h4><i class="fas fa-search"></i> Recherches par nom</h4>
                        <div class="form-inline">
                            <input id="ville-search-nom" type="text" placeholder="Nom exact">
                            <button class="btn btn-sm" onclick="villesSearchNom()">Chercher</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-search-contient" type="text" placeholder="Nom contient">
                            <button class="btn btn-sm" onclick="villesSearchNomContient()">Chercher</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-search-prefix" type="text" placeholder="Nom commence par">
                            <button class="btn btn-sm" onclick="villesNomCommence()">Chercher</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-users"></i> Population</h4>
                        <div class="form-inline">
                            <input id="ville-pop-min" type="number" placeholder="Min">
                            <button class="btn btn-sm" onclick="villesPopMin()">Filtrer</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-pop-min2" type="number" placeholder="Min">
                            <input id="ville-pop-max2" type="number" placeholder="Max">
                            <button class="btn btn-sm" onclick="villesPopPlage()">Filtrer</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-list-ol"></i> Pagination</h4>
                        <div class="form-inline">
                            <input id="ville-page" type="number" placeholder="Page" value="0">
                            <input id="ville-size" type="number" placeholder="Taille" value="20">
                            <button class="btn btn-sm" onclick="villesPaginated()">Charger</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-map-marker-alt"></i> Par département</h4>
                        <div class="form-inline">
                            <input id="ville-dept-code" type="text" placeholder="Code (ex: 34)">
                            <input id="ville-dept-min" type="number" placeholder="Min (optionnel)">
                            <button class="btn btn-sm" onclick="villesDeptMin()">Lister</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-dept-code2" type="text" placeholder="Code">
                            <input id="ville-dept-min2" type="number" placeholder="Min">
                            <input id="ville-dept-max2" type="number" placeholder="Max">
                            <button class="btn btn-sm" onclick="villesDeptPlage()">Lister</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-dept-code3" type="text" placeholder="Code">
                            <input id="ville-dept-topn" type="number" placeholder="Top N" value="10">
                            <button class="btn btn-sm" onclick="villesDeptTop()">Top N</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-dept-code4" type="text" placeholder="Code">
                            <button class="btn btn-sm" onclick="villesDeptPlusPeuplee()">Plus peuplée</button>
                            <button class="btn btn-sm" onclick="villesDeptStats()">Stats</button>
                            <button class="btn btn-sm" onclick="villesExportByDept()">Exporter</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-sliders-h"></i> Recherche avancée</h4>
                        <div class="form-inline">
                            <input id="ville-adv-nom" type="text" placeholder="Nom (optionnel)">
                            <input id="ville-adv-min" type="number" placeholder="Min (optionnel)">
                            <input id="ville-adv-max" type="number" placeholder="Max (optionnel)">
                            <input id="ville-adv-dept" type="text" placeholder="Dept (optionnel)">
                            <button class="btn btn-sm" onclick="villesRechercheAvancee()">Rechercher</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-tools"></i> Gestion ponctuelle</h4>
                        <div class="form-inline">
                            <input id="ville-update-id" type="number" placeholder="ID ville">
                            <input id="ville-update-pop" type="number" placeholder="Nv. population">
                            <button class="btn btn-sm" onclick="villesUpdatePopulation()">Mettre à jour</button>
                        </div>
                        <div class="form-inline">
                            <input id="ville-quick-nom" type="text" placeholder="Nom">
                            <input id="ville-quick-pop" type="number" placeholder="Habitants">
                            <input id="ville-quick-dept" type="text" placeholder="Code dept">
                            <button class="btn btn-sm" onclick="villesCreationRapide()">Créer rapide</button>
                        </div>
                        <div class="form-inline">
                            <button class="btn btn-sm" onclick="villesCount()">Compter les villes</button>
                        </div>
                        <div class="form-block">
                            <textarea id="ville-import-json" placeholder='Coller un tableau JSON de villes (DTO)'></textarea>
                            <button class="btn btn-sm" onclick="villesImport()">Importer</button>
                        </div>
                    </div>
                </div>
            </details>

            <!-- Liste des villes -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-city"></i> Nom</th>
                            <th><i class="fas fa-users"></i> Population</th>
                            <th><i class="fas fa-map-marker-alt"></i> Département</th>
                            <th><i class="fas fa-cogs"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody id="villes-list">
                        <!-- Les villes seront chargées ici via JavaScript -->
                    </tbody>
                </table>
                
                <!-- Pagination des villes -->
                <div id="villes-pagination" class="pagination-container"></div>
            </div>
            </div>




        <!-- Section Départements -->
        <div id="departements-section" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-map"></i> Gestion des Départements</h2>
                <button class="btn btn-primary" onclick="showAddDepartementForm()">
                    <i class="fas fa-plus"></i> Ajouter un département
                </button>
            </div>

            <!-- Formulaire d'ajout/modification de département -->
            <div id="departement-form-container" class="form-container hidden">
                <div class="form-header">
                    <h3 id="departement-form-title"><i class="fas fa-plus"></i> Ajouter un nouveau département</h3>
                    <button class="btn-close" onclick="hideDepartementForm()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="departement-form">
                    <div class="form-group">
                        <label for="departement-code"><i class="fas fa-hashtag"></i> Code du département</label>
                        <input type="text" id="departement-code" name="code" required
                               placeholder="Ex: 75, 13, 69..." maxlength="3" pattern="[0-9A-Z]{2,3}">
                    </div>
                    <div class="form-group">
                        <label for="departement-nom"><i class="fas fa-map"></i> Nom du département</label>
                        <input type="text" id="departement-nom" name="nom" required
                               placeholder="Ex: Paris, Bouches-du-Rhône..." maxlength="100">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="hideDepartementForm()">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </form>
            </div>

            <!-- Statistiques des départements -->
            <div class="stats-container">
                <div class="stat-card">
                    <i class="fas fa-map"></i>
                    <div class="stat-content">
                        <h3 id="total-departements">0</h3>
                        <p>Départements</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-building"></i>
                    <div class="stat-content">
                        <h3 id="total-villes-stats">0</h3>
                        <p>Villes totales</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-content">
                        <h3 id="total-population">0</h3>
                        <p>Population totale</p>
                    </div>
                </div>
            </div>


            <!-- Outils avancés Départements -->
            <details class="advanced-tools">
                <summary><i class="fas fa-wrench"></i> Recherches et outils avancés (Départements)</summary>
                <div class="advanced-grid">
                    <div class="tool-card">
                        <h4><i class="fas fa-search"></i> Recherches</h4>
                        <div class="form-inline">
                            <input id="dep-search-nom" type="text" placeholder="Nom">
                            <button class="btn btn-sm" onclick="depSearchNom()">Chercher</button>
                        </div>
                        <div class="form-inline">
                            <button class="btn btn-sm" onclick="depAvecNom()">Avec nom</button>
                            <button class="btn btn-sm" onclick="depSansNom()">Sans nom</button>
                            <button class="btn btn-sm" onclick="depAvecVilles()">Avec villes</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-min-villes" type="number" placeholder="Min villes">
                            <button class="btn btn-sm" onclick="depMinVilles()">Filtrer</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-min-pop" type="number" placeholder="Min population">
                            <button class="btn btn-sm" onclick="depMinPopulation()">Filtrer</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-layer-group"></i> Catégories & codes</h4>
                        <div class="form-inline">
                            <button class="btn btn-sm" onclick="depMetropolitains()">Métropolitains</button>
                            <button class="btn btn-sm" onclick="depOutreMer()">Outre-mer</button>
                            <button class="btn btn-sm" onclick="depCorse()">Corse</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-code-prefix" type="text" placeholder="Code commence par">
                            <button class="btn btn-sm" onclick="depCodeCommence()">Filtrer</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-building"></i> Villes par département</h4>
                        <div class="form-inline">
                            <input id="dep-code-villes" type="text" placeholder="Code dept">
                            <button class="btn btn-sm" onclick="depVillesByCode()">Lister</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-code-top" type="text" placeholder="Code">
                            <input id="dep-top-n" type="number" value="10" placeholder="Top N">
                            <button class="btn btn-sm" onclick="depTopByCode()">Top N</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-code-min" type="text" placeholder="Code">
                            <input id="dep-min" type="number" placeholder="Min">
                            <button class="btn btn-sm" onclick="depVillesPopMin()">Min population</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-code-range" type="text" placeholder="Code">
                            <input id="dep-range-min" type="number" placeholder="Min">
                            <input id="dep-range-max" type="number" placeholder="Max">
                            <button class="btn btn-sm" onclick="depVillesPopPlage()">Dans plage</button>
                        </div>
                    </div>

                    <div class="tool-card">
                        <h4><i class="fas fa-chart-bar"></i> Statistiques & gestion</h4>
                        <div class="form-inline">
                            <button class="btn btn-sm" onclick="depCount()">Compter départements</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-code-stats" type="text" placeholder="Code">
                            <button class="btn btn-sm" onclick="depStatsByCode()">Stats (code)</button>
                            <button class="btn btn-sm" onclick="depPopulationTotaleByCode()">Population totale</button>
                            <button class="btn btn-sm" onclick="depNombreVillesByCode()">Nombre de villes</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-create-code" type="text" placeholder="Code">
                            <input id="dep-create-nom" type="text" placeholder="Nom (optionnel)">
                            <button class="btn btn-sm" onclick="depCreationRapide()">Créer rapide</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-update-code" type="text" placeholder="Code">
                            <input id="dep-update-nom" type="text" placeholder="Nouveau nom">
                            <button class="btn btn-sm" onclick="depUpdateNomByCode()">Mettre à jour nom</button>
                        </div>
                        <div class="form-inline">
                            <button class="btn btn-sm" onclick="depUpdateNomsManquants()">Compléter noms manquants</button>
                        </div>
                        <div class="form-inline">
                            <input id="dep-exists-code" type="text" placeholder="Code">
                            <button class="btn btn-sm" onclick="depExistsByCode()">Existe ?</button>
                        </div>
                    </div>
                </div>
            </details>

            <!-- Filtres et recherche départements -->
            <div class="filters-container">
                <div class="search-group">
                    <i class="fas fa-search"></i>
                    <input type="text" id="departement-search" placeholder="Rechercher un département..." onkeyup="filterDepartements()">
                </div>
                <div class="sort-group">
                    <label for="departement-sort">Trier par :</label>
                    <select id="departement-sort" onchange="sortDepartements()">
                        <option value="nom">Nom (A-Z)</option>
                        <option value="code">Code</option>
                        <option value="population">Population</option>
                        <option value="nombreVilles">Nombre de villes</option>
                    </select>
                </div>
            </div>

            <!-- Liste des départements -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th><i class="fas fa-hashtag"></i> Code</th>
                            <th><i class="fas fa-map"></i> Nom</th>
                            <th><i class="fas fa-building"></i> Villes</th>
                            <th><i class="fas fa-users"></i> Population</th>
                            <th><i class="fas fa-cogs"></i> Actions</th>
                        </tr>
                    </thead>
                    <tbody id="departements-list">
                        <!-- Les départements seront chargés ici via JavaScript -->
                    </tbody>
                </table>
                
                <!-- Pagination des départements -->
                <div id="departements-pagination" class="pagination-container"></div>
            </div>
        </div>

        <!-- Modal de confirmation -->
        <div id="confirm-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="confirm-title">Confirmation</h3>
                    <button class="btn-close" onclick="hideConfirmModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="confirm-message">Êtes-vous sûr de vouloir effectuer cette action ?</p>
                </div>
                <div class="modal-actions">
                    <button id="confirm-yes" class="btn btn-danger">
                        <i class="fas fa-check"></i> Confirmer
                    </button>
                    <button class="btn btn-secondary" onclick="hideConfirmModal()">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                </div>
            </div>
        </div>

        <!-- Modal de détail -->
        <div id="detail-modal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 id="detail-title">Détails</h3>
                    <button class="btn-close" onclick="hideDetailModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="detail-content">
                    <!-- Contenu généré dynamiquement -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="hideDetailModal()">
                        <i class="fas fa-times"></i> Fermer
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading overlay -->
        <div id="loading" class="loading hidden">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Chargement en cours...</p>
            </div>
        </div>
    </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
